{"version":"0.3.0","body":"function main(workbook: ExcelScript.Workbook) {\n    const activeCell = workbook.getActiveCell();\n    const allSheets = workbook.getWorksheets();\n    const overallSheet = activeCell.getWorksheet();\n    const row = activeCell.getRowIndex();\n    const col = activeCell.getColumnIndex();\n    var sheetName = activeCell.getText();\n    const searchArea = \"A1:Z1\"; // Example range (first row);\n    const indexSheet = workbook.getWorksheet(\"INDEX\");\n\n    const headers = [\"编号\", \"描述\", \"位置\", \"颜色\", \"饰面\", \"尺寸\", \"厚度\"];\n    const headerRowValues = indexSheet.getRange(searchArea).getValues();\n\n    if (!headerRowValues || headerRowValues.length === 0 || !headerRowValues[0]) {\n        console.log(\"INDEX sheet header row is empty or not found. Aborting.\");\n        return;\n    }\n    // Find column indices in the INDEX sheet by checking if the header includes the keyword\n    const columnIndices = headers.reduce((acc, header) => {\n        let colIndex = headerRowValues[0].findIndex(cell => cell && cell.toString().includes(header));\n        if (colIndex !== -1) {\n            acc[header] = colIndex;\n        }\n        return acc;\n    }, {} as { [key: string]: number });\n\n    // Define mapping dynamically using columnIndices\n    const copyMapping: { sourceHeader: string; targetCell: string }[] = [\n        { sourceHeader: \"编号\", targetCell: \"B12\" },\n        { sourceHeader: \"描述\", targetCell: \"B14\" },\n        { sourceHeader: \"位置\", targetCell: \"B20\" },\n        { sourceHeader: \"饰面\", targetCell: \"B22\" },\n        { sourceHeader: \"颜色\", targetCell: \"B24\" },\n        { sourceHeader: \"尺寸\", targetCell: \"B26\" },\n        { sourceHeader: \"厚度\", targetCell: \"B28\" }\n    ];\n\n    if (columnIndices[\"编号\"] !== undefined) {\n        const codeCell = overallSheet.getCell(row, columnIndices[\"编号\"]);\n        const codeValue = codeCell.getValue();\n        if (codeValue !== \"\" && codeValue !== null) {\n            sheetName = codeValue.toString();\n        }\n    }\n\n\n    if (!sheetName) {\n        if (!indexSheet) {\n            console.log(\"INDEX sheet not found. Aborting.\");\n            return;\n        }\n        indexSheet.activate();\n        console.log(\"Cell content is empty. Switched to the INDEX sheet.\");\n        return;\n    }\n\n    if (!workbook.getWorksheet(sheetName)) {\n        let templateSheet = workbook.getWorksheet(\"TEMPLATE\");\n        let newSheet = templateSheet.copy();\n        newSheet.setName(sheetName);\n    } else if (col === 3) {\n        let targetSheet = workbook.getWorksheet(sheetName);\n        if (!targetSheet) {\n            let templateSheet = workbook.getWorksheet(\"TEMPLATE\");\n            targetSheet = templateSheet.copy();\n        }\n        targetSheet.activate();\n        console.log(`Switched to sheet: ${sheetName}`);\n        return;\n    }\n\n    let targetSheet = workbook.getWorksheet(sheetName);\n    if (!indexSheet) {\n        console.log(\"INDEX sheet not found. Aborting.\");\n        return;\n    }\n\n\n\n    let newSheetName = sheetName;\n\n    targetSheet.setName(newSheetName);\n\n    copyMapping.forEach(mapping => {\n        let sourceCol = columnIndices[mapping.sourceHeader];\n        if (sourceCol !== undefined) {\n            const sourceCell = overallSheet.getCell(row, sourceCol);\n            const cellValue = sourceCell.getValue();\n            if (cellValue !== \"\" && cellValue !== null) { // Only copy if the value is not empty\n                const targetCell = targetSheet.getRange(mapping.targetCell);\n                targetCell.setValue(cellValue);\n            }\n        }\n    });\n\n    console.log(`Data has been successfully transferred to sheet: ${newSheetName}`);\n}\n","description":"","noCodeMetadata":null,"parameterInfo":"{\"originalParameterOrder\":[],\"parameterSchema\":{\"type\":\"object\",\"default\":{},\"x-ms-visibility\":\"internal\"},\"returnSchema\":{\"type\":\"object\",\"properties\":{}}}","apiInfo":"{\"variant\":\"synchronous\",\"variantVersion\":2}"}